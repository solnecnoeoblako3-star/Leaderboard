
def get_translation(key, lang='ru', **kwargs):
    """Get translation for key in specified language"""
    translation = translations.get(lang, {}).get(key, translations['ru'].get(key, key))
    if kwargs:
        try:
            return translation.format(**kwargs)
        except (KeyError, ValueError):
            return translation
    return translation

def register_translation_filter(app):
    """Register translation filter for Jinja2"""
    @app.template_filter('t')
    def translate_filter(key, **kwargs):
        from flask import session
        lang = session.get('language', 'ru')
        return get_translation(key, lang, **kwargs)

    return translate_filter

# Translation system for the Bedwars Leaderboard
from flask import session

# Translation dictionaries
TRANSLATIONS = {
    'ru': {
        'best_minecraft_bedwars_players': 'Лучшие игроки Minecraft Bedwars',
        'leaders': 'Лидеры',
        'statistics': 'Статистика',
        'quests': 'Квесты',
        'achievements': 'Достижения',
        'clans': 'Кланы',
        'tournaments': 'Турниры',
        'shop': 'Магазин',
        'profile': 'Профиль',
        'admin_panel': 'Админ панель',
        'role_management': 'Управление ролями',
        'logout': 'Выйти',
        'login': 'Вход',
        'nickname': 'Никнейм',
        'level': 'Уровень',
        'experience': 'Опыт',
        'kills': 'Киллы',
        'deaths': 'Смерти',
        'wins': 'Победы',
        'games': 'Игры',
        'beds_broken': 'Кровати сломано',
        'rating': 'Рейтинг',
        'reputation': 'Репутация',
        'coins': 'Койны',
        'role': 'Роль',
        'server': 'Сервер',
        'join_date': 'Дата регистрации',
        'last_seen': 'Последний вход',
        'win_rate': 'Процент побед',
        'kd_ratio': 'K/D соотношение',
        'search_placeholder': 'Поиск игроков...',
        'sort_by': 'Сортировать по',
        'filter': 'Фильтр',
        'all': 'Все',
        'online': 'Онлайн',
        'offline': 'Оффлайн',
        'premium': 'Premium',
        'regular': 'Обычные',
        'add_player': 'Добавить игрока',
        'edit_player': 'Редактировать игрока',
        'delete_player': 'Удалить игрока',
        'confirm_delete': 'Подтвердить удаление',
        'save_changes': 'Сохранить изменения',
        'cancel': 'Отмена',
        'submit': 'Отправить',
        'back': 'Назад',
        'next': 'Далее',
        'previous': 'Предыдущий',
        'page': 'Страница',
        'of': 'из',
        'total': 'Всего',
        'no_results': 'Результаты не найдены',
        'loading': 'Загрузка...',
        'error': 'Ошибка',
        'success': 'Успешно',
        'warning': 'Предупреждение',
        'info': 'Информация',
        'reputation_guide_title': 'Репутация',
        'coins_guide_title': 'Койны',
        'themes': 'Темы',
        'create_role': 'Создать роль',
        'role_name': 'Название роли',
        'role_color': 'Цвет роли',
        'role_emoji': 'Эмодзи роли',
        'gradient': 'Градиент',
        'visible': 'Видимая',
        'players_with_role': 'Игроки с ролью',
        'assign_role': 'Назначить роль',
        'remove_role': 'Убрать роль',
        'custom_roles': 'Кастомные роли',
        'player': 'Игрок',
        'select_player': 'Выберите игрока',
        'select_role': 'Выберите роль',
        'actions': 'Действия',
        'created': 'Создано',
        'assigned': 'Назначено',
        'remove': 'Удалить',
        'edit': 'Редактировать',
        'view': 'Просмотреть'
    },
    'ua': {
        'best_minecraft_bedwars_players': 'Найкращі гравці Minecraft Bedwars',
        'leaders': 'Лідери',
        'statistics': 'Статистика',
        'quests': 'Квести',
        'achievements': 'Досягнення',
        'clans': 'Клани',
        'tournaments': 'Турніри',
        'shop': 'Магазин',
        'profile': 'Профіль',
        'admin_panel': 'Адмін панель',
        'role_management': 'Управління ролями',
        'logout': 'Вийти',
        'login': 'Вхід',
        'nickname': 'Нікнейм',
        'level': 'Рівень',
        'experience': 'Досвід',
        'kills': 'Вбивства',
        'deaths': 'Смерті',
        'wins': 'Перемоги',
        'games': 'Ігри',
        'beds_broken': 'Ліжок зламано',
        'rating': 'Рейтинг',
        'reputation': 'Репутація',
        'coins': 'Монети',
        'role': 'Роль',
        'server': 'Сервер',
        'join_date': 'Дата реєстрації',
        'last_seen': 'Останній вхід',
        'win_rate': 'Відсоток перемог',
        'kd_ratio': 'K/D співвідношення',
        'search_placeholder': 'Пошук гравців...',
        'sort_by': 'Сортувати за',
        'filter': 'Фільтр',
        'all': 'Всі',
        'online': 'Онлайн',
        'offline': 'Офлайн',
        'premium': 'Premium',
        'regular': 'Звичайні',
        'add_player': 'Додати гравця',
        'edit_player': 'Редагувати гравця',
        'delete_player': 'Видалити гравця',
        'confirm_delete': 'Підтвердити видалення',
        'save_changes': 'Зберегти зміни',
        'cancel': 'Скасувати',
        'submit': 'Відправити',
        'back': 'Назад',
        'next': 'Далі',
        'previous': 'Попередній',
        'page': 'Сторінка',
        'of': 'з',
        'total': 'Всього',
        'no_results': 'Результати не знайдені',
        'loading': 'Завантаження...',
        'error': 'Помилка',
        'success': 'Успішно',
        'warning': 'Попередження',
        'info': 'Інформація',
        'reputation_guide_title': 'Репутація',
        'coins_guide_title': 'Монети',
        'themes': 'Теми',
        'create_role': 'Створити роль',
        'role_name': 'Назва ролі',
        'role_color': 'Колір ролі',
        'role_emoji': 'Емодзі ролі',
        'gradient': 'Градієнт',
        'visible': 'Видима',
        'players_with_role': 'Гравці з роллю',
        'assign_role': 'Призначити роль',
        'remove_role': 'Прибрати роль',
        'custom_roles': 'Кастомні ролі',
        'player': 'Гравець',
        'select_player': 'Виберіть гравця',
        'select_role': 'Виберіть роль',
        'actions': 'Дії',
        'created': 'Створено',
        'assigned': 'Призначено',
        'remove': 'Видалити',
        'edit': 'Редагувати',
        'view': 'Переглянути'
    },
    'en': {
        'best_minecraft_bedwars_players': 'Best Minecraft Bedwars Players',
        'leaders': 'Leaders',
        'statistics': 'Statistics',
        'quests': 'Quests',
        'achievements': 'Achievements',
        'clans': 'Clans',
        'tournaments': 'Tournaments',
        'shop': 'Shop',
        'profile': 'Profile',
        'admin_panel': 'Admin Panel',
        'role_management': 'Role Management',
        'logout': 'Logout',
        'login': 'Login',
        'nickname': 'Nickname',
        'level': 'Level',
        'experience': 'Experience',
        'kills': 'Kills',
        'deaths': 'Deaths',
        'wins': 'Wins',
        'games': 'Games',
        'beds_broken': 'Beds Broken',
        'rating': 'Rating',
        'reputation': 'Reputation',
        'coins': 'Coins',
        'role': 'Role',
        'server': 'Server',
        'join_date': 'Join Date',
        'last_seen': 'Last Seen',
        'win_rate': 'Win Rate',
        'kd_ratio': 'K/D Ratio',
        'search_placeholder': 'Search players...',
        'sort_by': 'Sort by',
        'filter': 'Filter',
        'all': 'All',
        'online': 'Online',
        'offline': 'Offline',
        'premium': 'Premium',
        'regular': 'Regular',
        'add_player': 'Add Player',
        'edit_player': 'Edit Player',
        'delete_player': 'Delete Player',
        'confirm_delete': 'Confirm Delete',
        'save_changes': 'Save Changes',
        'cancel': 'Cancel',
        'submit': 'Submit',
        'back': 'Back',
        'next': 'Next',
        'previous': 'Previous',
        'page': 'Page',
        'of': 'of',
        'total': 'Total',
        'no_results': 'No results found',
        'loading': 'Loading...',
        'error': 'Error',
        'success': 'Success',
        'warning': 'Warning',
        'info': 'Info',
        'reputation_guide_title': 'Reputation',
        'coins_guide_title': 'Coins',
        'themes': 'Themes',
        'create_role': 'Create Role',
        'role_name': 'Role Name',
        'role_color': 'Role Color',
        'role_emoji': 'Role Emoji',
        'gradient': 'Gradient',
        'visible': 'Visible',
        'players_with_role': 'Players with Role',
        'assign_role': 'Assign Role',
        'remove_role': 'Remove Role',
        'custom_roles': 'Custom Roles',
        'player': 'Player',
        'select_player': 'Select Player',
        'select_role': 'Select Role',
        'actions': 'Actions',
        'created': 'Created',
        'assigned': 'Assigned',
        'remove': 'Remove',
        'edit': 'Edit',
        'view': 'View'
    }
}

def get_translation(key, language=None):
    """Get translation for a key in the specified language"""
    if language is None:
        language = session.get('language', 'ru')

    if language not in TRANSLATIONS:
        language = 'ru'  # fallback to Russian

    return TRANSLATIONS[language].get(key, key)

def register_translation_filter(app):
    """Register the translation filter with Flask app"""
    @app.template_filter('t')
    def translate_filter(key):
        """Translation filter for Jinja2 templates"""
        return get_translation(key)

    return translate_filter

# Globals for backward compatibility
translations = TRANSLATIONS
