
{% extends "base.html" %}

{% block title %}–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤ - Minecraft Bedwars{% endblock %}

{% block content %}
<div class="compare-page">
    <!-- Header -->
    <div class="text-center mb-5">
        <h1 class="display-4 fw-bold mb-3">
            <i class="fas fa-balance-scale me-3 ascend-icon"></i>
            <span class="ascend-title">COMPARISON</span>
        </h1>
        <p class="lead text-muted">–î–µ—Ç–∞–ª—å–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤</p>
    </div>

    <!-- Player Selection -->
    <div class="player-selection mb-5">
        <div class="selection-card">
            <div class="row align-items-center">
                <div class="col-md-5">
                    <div class="player-selector-section">
                        <h4 class="selector-title">
                            <span class="player-icon player-1">üë§</span>
                            –ò–ì–†–û–ö 1
                        </h4>
                        <select class="form-select player-selector" id="player1Select" data-player="1">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞...</option>
                            {% for player in players %}
                            <option value="{{ player.id }}" data-skin="{{ player.minecraft_skin_url }}" 
                                    data-level="{{ player.level }}" data-nickname="{{ player.nickname }}">
                                {{ player.nickname }} (‚òÖ {{ player.level }})
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                
                <div class="col-md-2 d-flex justify-content-center">
                    <div class="vs-separator">
                        <div class="vs-circle">
                            <span class="vs-text">VS</span>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-5">
                    <div class="player-selector-section">
                        <h4 class="selector-title">
                            <span class="player-icon player-2">üë§</span>
                            –ò–ì–†–û–ö 2
                        </h4>
                        <select class="form-select player-selector" id="player2Select" data-player="2">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ç–æ—Ä–æ–≥–æ –∏–≥—Ä–æ–∫–∞...</option>
                            {% for player in players %}
                            <option value="{{ player.id }}" data-skin="{{ player.minecraft_skin_url }}" 
                                    data-level="{{ player.level }}" data-nickname="{{ player.nickname }}">
                                {{ player.nickname }} (‚òÖ {{ player.level }})
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Comparison Results -->
    <div class="comparison-results d-none" id="comparisonResults">
        <div class="comparison-container">
            <!-- Player 1 Card -->
            <div class="player-comparison-card player-1-card" id="player1Card">
                <div class="card-gradient-border"></div>
                <div class="player-header">
                    <div class="player-rank">
                        <span class="rank-badge" id="player1Rank">#1</span>
                        <span class="rank-label">–†–ê–ù–ì</span>
                    </div>
                    <div class="player-info-section">
                        <h2 class="player-name" id="player1Name">Player</h2>
                        <div class="player-level-badge" id="player1Level">
                            <span class="level-star">‚òÖ</span>
                            <span class="level-number">1</span>
                        </div>
                    </div>
                </div>
                
                <div class="player-visual">
                    <div class="skin-container">
                        <img src="" alt="" class="player-skin-full" id="player1Skin">
                        <div class="skin-glow player-1-glow"></div>
                    </div>
                </div>
                
                <div class="stats-comparison" id="player1Stats">
                    <!-- Stats will be populated by JavaScript -->
                </div>
            </div>
            
            <!-- VS Divider -->
            <div class="vs-divider-section">
                <div class="comparison-line"></div>
                <div class="vs-badge">
                    <span class="vs-text-large">VS</span>
                    <div class="battle-sparks"></div>
                </div>
                <div class="comparison-line"></div>
            </div>
            
            <!-- Player 2 Card -->
            <div class="player-comparison-card player-2-card" id="player2Card">
                <div class="card-gradient-border"></div>
                <div class="player-header">
                    <div class="player-rank">
                        <span class="rank-badge" id="player2Rank">#2</span>
                        <span class="rank-label">–†–ê–ù–ì</span>
                    </div>
                    <div class="player-info-section">
                        <h2 class="player-name" id="player2Name">Player</h2>
                        <div class="player-level-badge" id="player2Level">
                            <span class="level-star">‚òÖ</span>
                            <span class="level-number">1</span>
                        </div>
                    </div>
                </div>
                
                <div class="player-visual">
                    <div class="skin-container">
                        <img src="" alt="" class="player-skin-full" id="player2Skin">
                        <div class="skin-glow player-2-glow"></div>
                    </div>
                </div>
                
                <div class="stats-comparison" id="player2Stats">
                    <!-- Stats will be populated by JavaScript -->
                </div>
            </div>
        </div>
        
        <!-- Comparison Summary -->
        <div class="comparison-summary" id="comparisonSummary">
            <div class="summary-card">
                <div class="summary-header">
                    <h3><i class="fas fa-chart-bar"></i> –ò–¢–û–ì–ò –°–†–ê–í–ù–ï–ù–ò–Ø</h3>
                </div>
                <div class="summary-content" id="summaryContent">
                    <!-- Summary will be populated -->
                </div>
            </div>
        </div>
        
        <!-- Winner Declaration -->
        <div class="winner-declaration d-none" id="winnerDeclaration">
            <div class="winner-card">
                <div class="winner-crown">üëë</div>
                <div class="winner-content">
                    <h2 class="winner-title">–ü–û–ë–ï–î–ò–¢–ï–õ–¨</h2>
                    <h3 class="winner-name" id="winnerName">Player Name</h3>
                    <p class="winner-score" id="winnerScore">–í—ã–∏–≥—Ä—ã–≤–∞–µ—Ç –≤ 7 –∏–∑ 10 –∫–∞—Ç–µ–≥–æ—Ä–∏–π</p>
                </div>
                <div class="winner-effects"></div>
            </div>
        </div>
    </div>
</div>

<style>
.compare-page {
    max-width: 1400px;
    margin: 0 auto;
    padding: 2rem 1rem;
}

.ascend-icon {
    background: linear-gradient(45deg, #ffc107, #ff6b35, #f7931e);
    background-size: 200% 200%;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    animation: gradientShift 3s ease-in-out infinite;
}

.ascend-title {
    background: linear-gradient(45deg, #ffc107, #ff6b35, #f7931e, #28a745);
    background-size: 300% 300%;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    animation: gradientShift 4s ease-in-out infinite;
    font-weight: 900;
    letter-spacing: 2px;
}

.selection-card {
    background: linear-gradient(135deg, rgba(0, 0, 0, 0.6), rgba(33, 37, 41, 0.8));
    border: 2px solid rgba(255, 193, 7, 0.3);
    border-radius: 20px;
    padding: 2rem;
    backdrop-filter: blur(15px);
    position: relative;
    overflow: hidden;
}

.selection-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #ff6b35, #ffc107, #28a745, #17a2b8);
    background-size: 300% 100%;
    animation: borderGlow 3s linear infinite;
}

.player-selector-section {
    text-align: center;
}

.selector-title {
    color: #ffffff;
    margin-bottom: 1rem;
    font-weight: bold;
    font-size: 1.1rem;
}

.player-icon {
    font-size: 1.5rem;
    margin-right: 0.5rem;
}

.player-icon.player-1 {
    color: #17a2b8;
}

.player-icon.player-2 {
    color: #dc3545;
}

.player-selector {
    background: rgba(0, 0, 0, 0.7);
    border: 2px solid rgba(255, 255, 255, 0.2);
    color: #ffffff;
    border-radius: 12px;
    padding: 0.75rem;
    font-size: 1rem;
    transition: all 0.3s ease;
}

.player-selector:focus {
    border-color: #ffc107;
    box-shadow: 0 0 0 0.2rem rgba(255, 193, 7, 0.25);
    background: rgba(0, 0, 0, 0.9);
}

.vs-separator {
    text-align: center;
}

.vs-circle {
    width: 80px;
    height: 80px;
    border: 3px solid #ffc107;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(45deg, rgba(255, 193, 7, 0.2), rgba(255, 107, 53, 0.2));
    backdrop-filter: blur(10px);
    animation: vsCirclePulse 2s ease-in-out infinite;
}

.vs-text {
    font-weight: 900;
    font-size: 1.5rem;
    color: #ffc107;
    text-shadow: 0 0 10px rgba(255, 193, 7, 0.8);
}

@keyframes vsCirclePulse {
    0%, 100% { 
        transform: scale(1);
        box-shadow: 0 0 20px rgba(255, 193, 7, 0.5);
    }
    50% { 
        transform: scale(1.1);
        box-shadow: 0 0 30px rgba(255, 193, 7, 0.8);
    }
}

.comparison-container {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    gap: 2rem;
    align-items: start;
}

.player-comparison-card {
    background: linear-gradient(145deg, rgba(0, 0, 0, 0.8), rgba(33, 37, 41, 0.9));
    border-radius: 20px;
    overflow: hidden;
    position: relative;
    min-height: 600px;
    transition: all 0.4s ease;
}

.card-gradient-border {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    border-radius: 20px;
    padding: 3px;
    background: linear-gradient(45deg, transparent, rgba(255, 193, 7, 0.6), transparent);
    background-size: 200% 200%;
    animation: borderRotate 4s linear infinite;
    z-index: -1;
}

.player-1-card .card-gradient-border {
    background: linear-gradient(45deg, transparent, rgba(23, 162, 184, 0.8), transparent);
}

.player-2-card .card-gradient-border {
    background: linear-gradient(45deg, transparent, rgba(220, 53, 69, 0.8), transparent);
}

.player-header {
    padding: 1.5rem;
    background: rgba(0, 0, 0, 0.5);
    border-bottom: 1px solid rgba(255, 193, 7, 0.3);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.player-rank {
    text-align: center;
}

.rank-badge {
    display: block;
    font-size: 1.5rem;
    font-weight: 900;
    color: #ffc107;
    text-shadow: 0 0 10px rgba(255, 193, 7, 0.6);
}

.rank-label {
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.7);
}

.player-info-section {
    text-align: right;
}

.player-name {
    color: #ffffff;
    margin: 0;
    font-size: 1.8rem;
    font-weight: bold;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
}

.player-level-badge {
    background: linear-gradient(45deg, #ffc107, #ffca2c);
    color: #212529;
    padding: 0.3rem 0.8rem;
    border-radius: 15px;
    font-weight: bold;
    display: inline-flex;
    align-items: center;
    gap: 0.3rem;
    margin-top: 0.5rem;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
}

.player-visual {
    display: flex;
    justify-content: center;
    padding: 2rem;
    position: relative;
}

.skin-container {
    position: relative;
    width: 128px;
    height: 256px;
    display: flex;
    justify-content: center;
    align-items: center;
}

.player-skin-full {
    width: 128px;
    height: 256px;
    image-rendering: pixelated;
    border-radius: 8px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
    transition: all 0.3s ease;
}

.skin-glow {
    position: absolute;
    top: -10px;
    left: -10px;
    right: -10px;
    bottom: -10px;
    border-radius: 12px;
    opacity: 0.6;
    animation: skinGlow 3s ease-in-out infinite;
}

.player-1-glow {
    background: radial-gradient(circle, rgba(23, 162, 184, 0.4), transparent);
}

.player-2-glow {
    background: radial-gradient(circle, rgba(220, 53, 69, 0.4), transparent);
}

@keyframes skinGlow {
    0%, 100% { opacity: 0.3; transform: scale(0.95); }
    50% { opacity: 0.8; transform: scale(1.05); }
}

.stats-comparison {
    padding: 1.5rem;
}

.stat-comparison-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    margin: 0.5rem 0;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.stat-comparison-item::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 4px;
    background: #6c757d;
    transition: all 0.3s ease;
}

.stat-comparison-item.winner::before {
    background: #28a745;
    box-shadow: 0 0 10px rgba(40, 167, 69, 0.6);
}

.stat-comparison-item.loser::before {
    background: #dc3545;
}

.stat-label {
    font-weight: 600;
    color: rgba(255, 255, 255, 0.9);
    font-size: 0.9rem;
}

.stat-value {
    font-weight: bold;
    font-size: 1.1rem;
    position: relative;
}

.stat-indicator {
    margin-left: 0.5rem;
    font-size: 0.8rem;
    padding: 0.2rem 0.5rem;
    border-radius: 8px;
    font-weight: bold;
}

.indicator-positive {
    background: rgba(40, 167, 69, 0.8);
    color: #ffffff;
}

.indicator-negative {
    background: rgba(220, 53, 69, 0.8);
    color: #ffffff;
}

.vs-divider-section {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    position: relative;
    height: 600px;
}

.comparison-line {
    width: 2px;
    height: 200px;
    background: linear-gradient(180deg, transparent, #ffc107, transparent);
    margin: 1rem 0;
}

.vs-badge {
    position: relative;
    width: 100px;
    height: 100px;
    border: 4px solid #ffc107;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: radial-gradient(circle, rgba(255, 193, 7, 0.3), rgba(255, 107, 53, 0.2));
    backdrop-filter: blur(15px);
    animation: vsBadgeRotate 6s linear infinite;
}

.vs-text-large {
    font-size: 1.8rem;
    font-weight: 900;
    color: #ffc107;
    text-shadow: 0 0 15px rgba(255, 193, 7, 1);
}

.battle-sparks {
    position: absolute;
    top: -10px;
    left: -10px;
    right: -10px;
    bottom: -10px;
    border-radius: 50%;
    background: conic-gradient(from 0deg, transparent, #ffc107, transparent, #ff6b35, transparent);
    animation: sparkRotate 2s linear infinite;
    opacity: 0.6;
}

@keyframes vsBadgeRotate {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

@keyframes sparkRotate {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.comparison-summary {
    margin-top: 3rem;
}

.summary-card {
    background: linear-gradient(135deg, rgba(0, 0, 0, 0.8), rgba(33, 37, 41, 0.9));
    border: 2px solid rgba(255, 193, 7, 0.4);
    border-radius: 20px;
    padding: 2rem;
    text-align: center;
}

.summary-header h3 {
    color: #ffc107;
    margin-bottom: 1.5rem;
    font-weight: bold;
}

.summary-content {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
}

.summary-stat {
    background: rgba(255, 255, 255, 0.1);
    padding: 1rem;
    border-radius: 12px;
    transition: all 0.3s ease;
}

.summary-stat:hover {
    background: rgba(255, 193, 7, 0.1);
    transform: translateY(-2px);
}

.winner-declaration {
    margin-top: 2rem;
}

.winner-card {
    background: linear-gradient(135deg, rgba(255, 193, 7, 0.9), rgba(255, 152, 0, 0.9));
    color: #212529;
    border-radius: 20px;
    padding: 3rem 2rem;
    text-align: center;
    position: relative;
    overflow: hidden;
    box-shadow: 0 0 50px rgba(255, 193, 7, 0.8);
    animation: winnerGlow 3s ease-in-out infinite;
}

.winner-crown {
    font-size: 4rem;
    margin-bottom: 1rem;
    animation: crownBounce 2s ease-in-out infinite;
}

.winner-title {
    font-size: 2.5rem;
    font-weight: 900;
    margin-bottom: 0.5rem;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
}

.winner-name {
    font-size: 2rem;
    font-weight: bold;
    margin-bottom: 1rem;
}

.winner-effects {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    background-size: 200% 200%;
    animation: winnerSweep 3s ease-in-out infinite;
    pointer-events: none;
}

@keyframes winnerGlow {
    0%, 100% { 
        box-shadow: 0 0 50px rgba(255, 193, 7, 0.8);
        transform: scale(1);
    }
    50% { 
        box-shadow: 0 0 80px rgba(255, 193, 7, 1);
        transform: scale(1.02);
    }
}

@keyframes crownBounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}

@keyframes winnerSweep {
    0% { background-position: -200% 0; }
    100% { background-position: 200% 0; }
}

@keyframes borderRotate {
    0% { background-position: 0% 50%; }
    100% { background-position: 100% 50%; }
}

@keyframes borderGlow {
    0% { background-position: 0% 50%; }
    100% { background-position: 300% 50%; }
}

@keyframes gradientShift {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
}

/* Mobile Responsiveness */
@media (max-width: 768px) {
    .comparison-container {
        grid-template-columns: 1fr;
        grid-template-rows: auto auto auto;
        gap: 1rem;
    }
    
    .vs-divider-section {
        order: 2;
        height: auto;
        padding: 1rem 0;
    }
    
    .comparison-line {
        width: 100%;
        height: 2px;
        background: linear-gradient(90deg, transparent, #ffc107, transparent);
    }
    
    .vs-badge {
        width: 80px;
        height: 80px;
    }
    
    .vs-text-large {
        font-size: 1.5rem;
    }
    
    .player-comparison-card {
        min-height: auto;
    }
    
    .player-header {
        flex-direction: column;
        gap: 1rem;
        text-align: center;
    }
    
    .player-info-section {
        text-align: center;
    }
    
    .player-name {
        font-size: 1.5rem;
    }
    
    .summary-content {
        grid-template-columns: 1fr;
    }
    
    .winner-title {
        font-size: 2rem;
    }
    
    .winner-name {
        font-size: 1.5rem;
    }
}

@media (max-width: 576px) {
    .selection-card {
        padding: 1rem;
    }
    
    .vs-circle {
        width: 60px;
        height: 60px;
    }
    
    .vs-text {
        font-size: 1.2rem;
    }
    
    .player-skin-full {
        width: 96px;
        height: 192px;
    }
    
    .skin-container {
        width: 96px;
        height: 192px;
    }
    
    .stat-comparison-item {
        flex-direction: column;
        gap: 0.5rem;
        text-align: center;
    }
    
    .winner-crown {
        font-size: 3rem;
    }
    
    .winner-title {
        font-size: 1.8rem;
    }
}
</style>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const player1Select = document.getElementById('player1Select');
    const player2Select = document.getElementById('player2Select');
    const comparisonResults = document.getElementById('comparisonResults');
    let selectedPlayers = { player1: null, player2: null };
    
    // Handle player selection
    [player1Select, player2Select].forEach(select => {
        select.addEventListener('change', function() {
            const playerId = this.value;
            const playerNumber = this.dataset.player;
            
            if (playerId) {
                selectedPlayers[`player${playerNumber}`] = playerId;
            } else {
                selectedPlayers[`player${playerNumber}`] = null;
            }
            
            // Check if both players selected
            if (selectedPlayers.player1 && selectedPlayers.player2) {
                loadComparison();
            } else {
                comparisonResults.classList.add('d-none');
            }
        });
    });
    
    function loadComparison() {
        const player1Id = selectedPlayers.player1;
        const player2Id = selectedPlayers.player2;
        
        if (player1Id === player2Id) {
            alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è!');
            return;
        }
        
        fetch(`/api/compare/${player1Id}/${player2Id}`)
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    console.error('Error:', data.error);
                    return;
                }
                
                displayComparison(data);
            })
            .catch(error => {
                console.error('Error:', error);
            });
    }
    
    function displayComparison(data) {
        const { player1, player2 } = data;
        
        // Update player cards
        updatePlayerCard(1, player1);
        updatePlayerCard(2, player2);
        
        // Create comparison data
        const comparisonStats = createComparisonStats(player1, player2);
        
        // Update stats with comparison
        updateStatsComparison(1, comparisonStats, player1);
        updateStatsComparison(2, comparisonStats, player2);
        
        // Show results
        comparisonResults.classList.remove('d-none');
        
        // Animate cards entrance
        animateCardsEntrance();
        
        // Determine and show winner
        const winner = determineWinner(comparisonStats, player1, player2);
        showWinner(winner);
        
        // Update summary
        updateSummary(comparisonStats, player1, player2);
    }
    
    function updatePlayerCard(playerNum, playerData) {
        const prefix = `player${playerNum}`;
        
        // Update basic info
        document.getElementById(`${prefix}Name`).textContent = playerData.nickname;
        document.getElementById(`${prefix}Level`).querySelector('.level-number').textContent = playerData.level;
        document.getElementById(`${prefix}Skin`).src = getFullBodySkinUrl(playerData.skin_url);
        document.getElementById(`${prefix}Skin`).alt = playerData.nickname;
        
        // Update rank (you can calculate this based on experience or other metrics)
        const rank = calculatePlayerRank(playerData);
        document.getElementById(`${prefix}Rank`).textContent = `#${rank}`;
    }
    
    function getFullBodySkinUrl(skinUrl) {
        // Convert head skin URL to full body
        if (skinUrl.includes('mc-heads.net')) {
            return skinUrl.replace('/avatar/', '/body/').replace('/128', '/256');
        } else if (skinUrl.includes('crafatar.com')) {
            return skinUrl.replace('/avatars/', '/renders/body/').replace('size=128', 'size=256');
        }
        // Fallback to a full body skin service
        const username = extractUsernameFromSkin(skinUrl);
        return `https://mc-heads.net/body/${username || 'steve'}/256`;
    }
    
    function extractUsernameFromSkin(skinUrl) {
        if (skinUrl.includes('mc-heads.net')) {
            const match = skinUrl.match(/\/avatar\/([^\/]+)/);
            return match ? match[1] : null;
        }
        return null;
    }
    
    function calculatePlayerRank(playerData) {
        // Simple ranking calculation - you can make this more sophisticated
        return Math.max(1, Math.floor(Math.random() * 1000) + 1);
    }
    
    function createComparisonStats(player1, player2) {
        const stats = [
            { key: 'level', label: '–£—Ä–æ–≤–µ–Ω—å', icon: 'fas fa-star' },
            { key: 'experience', label: '–û–ø—ã—Ç', icon: 'fas fa-trophy', format: 'number' },
            { key: 'kills', label: '–£–±–∏–π—Å—Ç–≤–∞', icon: 'fas fa-sword', format: 'number' },
            { key: 'final_kills', label: '–§–∏–Ω–∞–ª—å–Ω—ã–µ —É–±–∏–π—Å—Ç–≤–∞', icon: 'fas fa-crosshairs', format: 'number' },
            { key: 'kd_ratio', label: 'K/D', icon: 'fas fa-chart-line', format: 'decimal' },
            { key: 'fkd_ratio', label: 'FK/D', icon: 'fas fa-target', format: 'decimal' },
            { key: 'beds_broken', label: '–°–ª–æ–º–∞–Ω–Ω—ã–µ –∫—Ä–æ–≤–∞—Ç–∏', icon: 'fas fa-bed', format: 'number' },
            { key: 'wins', label: '–ü–æ–±–µ–¥—ã', icon: 'fas fa-trophy', format: 'number' },
            { key: 'games_played', label: '–ò–≥—Ä—ã', icon: 'fas fa-gamepad', format: 'number' },
            { key: 'win_rate', label: '% –ø–æ–±–µ–¥', icon: 'fas fa-percentage', format: 'percentage' }
        ];
        
        return stats.map(stat => {
            const value1 = player1[stat.key];
            const value2 = player2[stat.key];
            let winner = null;
            let difference = 0;
            let percentageDiff = 0;
            
            if (value1 > value2) {
                winner = 1;
                difference = value1 - value2;
                percentageDiff = value2 > 0 ? ((difference / value2) * 100) : 100;
            } else if (value2 > value1) {
                winner = 2;
                difference = value2 - value1;
                percentageDiff = value1 > 0 ? ((difference / value1) * 100) : 100;
            }
            
            return {
                ...stat,
                value1,
                value2,
                winner,
                difference,
                percentageDiff: Math.round(percentageDiff)
            };
        });
    }
    
    function updateStatsComparison(playerNum, comparisonStats, playerData) {
        const statsContainer = document.getElementById(`player${playerNum}Stats`);
        
        statsContainer.innerHTML = comparisonStats.map(stat => {
            const value = playerNum === 1 ? stat.value1 : stat.value2;
            const isWinner = stat.winner === playerNum;
            const isLoser = stat.winner !== null && stat.winner !== playerNum;
            
            let indicator = '';
            if (stat.winner !== null) {
                if (isWinner) {
                    indicator = `<span class="stat-indicator indicator-positive">+${stat.percentageDiff}%</span>`;
                } else if (isLoser) {
                    indicator = `<span class="stat-indicator indicator-negative">-${stat.percentageDiff}%</span>`;
                }
            }
            
            const formattedValue = formatStatValue(value, stat.format);
            
            return `
                <div class="stat-comparison-item ${isWinner ? 'winner' : ''} ${isLoser ? 'loser' : ''}">
                    <div class="stat-label">
                        <i class="${stat.icon}"></i> ${stat.label}
                    </div>
                    <div class="stat-value">
                        ${formattedValue}
                        ${indicator}
                    </div>
                </div>
            `;
        }).join('');
    }
    
    function formatStatValue(value, format) {
        switch (format) {
            case 'number':
                return value.toLocaleString();
            case 'decimal':
                return parseFloat(value).toFixed(2);
            case 'percentage':
                return `${value}%`;
            default:
                return value;
        }
    }
    
    function determineWinner(comparisonStats, player1, player2) {
        let player1Wins = 0;
        let player2Wins = 0;
        
        comparisonStats.forEach(stat => {
            if (stat.winner === 1) {
                player1Wins++;
            } else if (stat.winner === 2) {
                player2Wins++;
            }
        });
        
        if (player1Wins > player2Wins) {
            return { player: player1, score: player1Wins, total: comparisonStats.length };
        } else if (player2Wins > player1Wins) {
            return { player: player2, score: player2Wins, total: comparisonStats.length };
        } else {
            return null; // Tie
        }
    }
    
    function showWinner(winner) {
        const declarationElement = document.getElementById('winnerDeclaration');
        const winnerNameElement = document.getElementById('winnerName');
        const winnerScoreElement = document.getElementById('winnerScore');
        
        if (winner) {
            winnerNameElement.textContent = winner.player.nickname;
            winnerScoreElement.textContent = `–ü–æ–±–µ–∂–¥–∞–µ—Ç –≤ ${winner.score} –∏–∑ ${winner.total} –∫–∞—Ç–µ–≥–æ—Ä–∏–π`;
            declarationElement.classList.remove('d-none');
        } else {
            winnerNameElement.textContent = '–ù–∏—á—å—è!';
            winnerScoreElement.textContent = '–ò–≥—Ä–æ–∫–∏ –ø–æ–∫–∞–∑–∞–ª–∏ —Ä–∞–≤–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã';
            declarationElement.classList.remove('d-none');
        }
        
        // Animate winner declaration
        setTimeout(() => {
            declarationElement.style.animation = 'winnerGlow 3s ease-in-out infinite';
        }, 500);
    }
    
    function updateSummary(comparisonStats, player1, player2) {
        const summaryContent = document.getElementById('summaryContent');
        
        const summaryStats = [
            {
                label: '–û–±—â–∏–π –ö/–î',
                value1: player1.kd_ratio,
                value2: player2.kd_ratio,
                format: 'decimal'
            },
            {
                label: '–°—Ä–µ–¥–Ω–∏–π –æ–ø—ã—Ç –∑–∞ –∏–≥—Ä—É',
                value1: player1.games_played > 0 ? Math.round(player1.experience / player1.games_played) : 0,
                value2: player2.games_played > 0 ? Math.round(player2.experience / player2.games_played) : 0,
                format: 'number'
            },
            {
                label: '–ö—Ä–æ–≤–∞—Ç–µ–π –∑–∞ –∏–≥—Ä—É',
                value1: player1.games_played > 0 ? (player1.beds_broken / player1.games_played).toFixed(2) : 0,
                value2: player2.games_played > 0 ? (player2.beds_broken / player2.games_played).toFixed(2) : 0,
                format: 'decimal'
            }
        ];
        
        summaryContent.innerHTML = summaryStats.map(stat => `
            <div class="summary-stat">
                <h5>${stat.label}</h5>
                <div class="row">
                    <div class="col-6">
                        <strong>${player1.nickname}:</strong> ${formatStatValue(stat.value1, stat.format)}
                    </div>
                    <div class="col-6">
                        <strong>${player2.nickname}:</strong> ${formatStatValue(stat.value2, stat.format)}
                    </div>
                </div>
            </div>
        `).join('');
    }
    
    function animateCardsEntrance() {
        const cards = document.querySelectorAll('.player-comparison-card');
        cards.forEach((card, index) => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(30px) scale(0.95)';
            
            setTimeout(() => {
                card.style.transition = 'all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
                card.style.opacity = '1';
                card.style.transform = 'translateY(0) scale(1)';
            }, index * 200);
        });
        
        // Animate VS divider
        const vsDivider = document.querySelector('.vs-divider-section');
        setTimeout(() => {
            vsDivider.style.animation = 'vsBadgeRotate 6s linear infinite';
        }, 400);
    }
});
</script>
{% endblock %}
