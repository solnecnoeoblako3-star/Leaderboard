
{% extends "base.html" %}

{% block title %}–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∏—Ç—É–ª–∞–º–∏ - ·¥á ü…™·¥õ·¥á Íú±Q·¥ú·¥Ä·¥Ö Bedwars{% endblock %}

{% block extra_head %}
<style>
.title-card {
    background: linear-gradient(145deg, #2a2a2a, #1a1a1a);
    border: 1px solid #444;
    border-radius: 15px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 8px 16px rgba(0,0,0,0.3);
    transition: transform 0.3s ease;
}

.title-card:hover {
    transform: translateY(-5px);
}

.title-preview {
    padding: 10px 20px;
    border-radius: 25px;
    font-weight: bold;
    margin: 10px 0;
    text-align: center;
    position: relative;
    overflow: hidden;
}

.title-preview::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, transparent 30%, rgba(255,255,255,0.1) 70%);
    animation: shimmer 3s linear infinite;
}

@keyframes shimmer {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.assign-section {
    background: rgba(33, 37, 41, 0.8);
    border-radius: 12px;
    padding: 2rem;
    margin-bottom: 2rem;
}

.player-with-title {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px;
    margin: 10px 0;
    background: rgba(52, 58, 64, 0.6);
    border-radius: 10px;
    border-left: 4px solid #ffd700;
}

.color-preview {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    border: 2px solid #fff;
    display: inline-block;
    margin: 0 10px;
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="page-title">
            <i class="fas fa-crown text-warning me-2 glow-effect"></i>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∏—Ç—É–ª–∞–º–∏
        </h2>
        <div class="btn-group">
            <button class="btn btn-success" data-bs-target="#createTitleModal" data-bs-toggle="modal">
                <i class="fas fa-plus me-2"></i>–°–æ–∑–¥–∞—Ç—å —Ç–∏—Ç—É–ª
            </button>
            <button class="btn btn-warning" onclick="removeAllTitles()">
                <i class="fas fa-crown me-2"></i>–°–Ω—è—Ç—å –≤—Å–µ —Ç–∏—Ç—É–ª—ã
            </button>
            <a href="{{ url_for('admin') }}" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left me-2"></i>–ù–∞–∑–∞–¥
            </a>
        </div>
    </div>

    <!-- Assign Title Section -->
    <div class="assign-section">
        <h4 class="text-warning mb-3">
            <i class="fas fa-user-tag me-2"></i>–ü—Ä–∏—Å–≤–æ–∏—Ç—å —Ç–∏—Ç—É–ª –∏–≥—Ä–æ–∫—É
        </h4>
        <form method="POST" action="{{ url_for('assign_title') }}">
            <div class="row">
                <div class="col-md-4">
                    <label class="form-label">–ò–≥—Ä–æ–∫</label>
                    <select name="player_id" class="form-select" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞</option>
                        {% for player in players %}
                        <option value="{{ player.id }}">
                            {{ player.nickname }} (–£—Ä–æ–≤–µ–Ω—å {{ player.level }})
                        </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4">
                    <label class="form-label">–¢–∏—Ç—É–ª</label>
                    <select name="title_id" class="form-select" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏—Ç—É–ª</option>
                        {% for title in titles %}
                        <option value="{{ title.id }}">{{ title.display_name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4">
                    <label class="form-label">&nbsp;</label>
                    <button type="submit" class="btn btn-warning d-block">
                        <i class="fas fa-award me-2"></i>–ü—Ä–∏—Å–≤–æ–∏—Ç—å
                    </button>
                </div>
            </div>
        </form>
    </div>

    <!-- Current Players with Titles -->
    <div class="mb-4">
        <h4 class="text-info mb-3">
            <i class="fas fa-users me-2"></i>–ò–≥—Ä–æ–∫–∏ —Å —Ç–∏—Ç—É–ª–∞–º–∏
        </h4>
        {% for player in players %}
        {% if player.active_custom_title %}
        <div class="player-with-title">
            <div>
                <strong>{{ player.nickname }}</strong>
                <span class="title-preview" 
                      style="background: linear-gradient(45deg, {{ player.active_custom_title.color }}, {{ player.active_custom_title.glow_color }}); 
                             color: #fff; text-shadow: 0 0 10px {{ player.active_custom_title.glow_color }};">
                    {{ player.active_custom_title.display_name }}
                </span>
            </div>
            <button class="btn btn-sm btn-outline-danger" onclick="removeTitle({{ player.id }})">
                <i class="fas fa-times"></i> –£–±—Ä–∞—Ç—å
            </button>
        </div>
        {% endif %}
        {% endfor %}
    </div>

    <!-- Available Titles -->
    <div class="row">
        <div class="col-12">
            <h4 class="text-success mb-3">
                <i class="fas fa-list me-2"></i>–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–∏—Ç—É–ª—ã
            </h4>
        </div>
        {% for title in titles %}
        <div class="col-lg-6 col-xl-4">
            <div class="title-card">
                <div class="text-center mb-3">
                    <h5>{{ title.name|title }}</h5>
                    <div class="title-preview" 
                         style="background: linear-gradient(45deg, {{ title.color }}, {{ title.glow_color }}); 
                                color: #fff; text-shadow: 0 0 10px {{ title.glow_color }};">
                        {{ title.display_name }}
                    </div>
                </div>

                <div class="row text-center">
                    <div class="col-6">
                        <small class="text-muted">–û—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç</small>
                        <div class="color-preview" style="background: {{ title.color }};"></div>
                    </div>
                    <div class="col-6">
                        <small class="text-muted">–¶–≤–µ—Ç —Å–≤–µ—á–µ–Ω–∏—è</small>
                        <div class="color-preview" style="background: {{ title.glow_color }};"></div>
                    </div>
                </div>

                <div class="text-center mt-3">
                    <small class="text-muted">
                        –°–æ–∑–¥–∞–Ω: {{ title.created_at.strftime('%d.%m.%Y') }}
                    </small>
                </div>

                <div class="d-flex gap-2 mt-3">
                    <button class="btn btn-sm btn-outline-primary" onclick="editTitle({{ title.id }})">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-danger" onclick="deleteTitle({{ title.id }})">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Create Title Modal -->
<div class="modal fade" id="createTitleModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content bg-dark">
            <form method="POST" action="{{ url_for('create_title') }}">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-plus me-2"></i>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ç–∏—Ç—É–ª
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">–°–∏—Å—Ç–µ–º–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ</label>
                        <input type="text" name="name" class="form-control" required 
                               placeholder="legend, champion, master...">
                        <small class="text-muted">–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º–µ (—Ç–æ–ª—å–∫–æ –ª–∞—Ç–∏–Ω–∏—Ü–∞, –±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤)</small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">–û—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ</label>
                        <input type="text" name="display_name" class="form-control" required 
                               placeholder="üèÜ –õ–µ–≥–µ–Ω–¥–∞, üëë –ß–µ–º–ø–∏–æ–Ω...">
                        <small class="text-muted">–ö–∞–∫ –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∏–≥—Ä–æ–∫–∞–º</small>
                    </div>
                    <div class="row">
                        <div class="col-6">
                            <label class="form-label">–û—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç</label>
                            <input type="color" name="color" class="form-control form-control-color" value="#ffd700">
                        </div>
                        <div class="col-6">
                            <label class="form-label">–¶–≤–µ—Ç —Å–≤–µ—á–µ–Ω–∏—è</label>
                            <input type="color" name="glow_color" class="form-control form-control-color" value="#ffaa00">
                        </div>
                    </div>
                    <div class="mt-3">
                        <label class="form-label">–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä</label>
                        <div id="titlePreview" class="title-preview" style="background: linear-gradient(45deg, #ffd700, #ffaa00); color: #fff;">
                            –ü—Ä–∏–º–µ—Ä —Ç–∏—Ç—É–ª–∞
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-success">–°–æ–∑–¥–∞—Ç—å —Ç–∏—Ç—É–ª</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
function removeTitle(playerId) {
    if (confirm('–£–±—Ä–∞—Ç—å —Ç–∏—Ç—É–ª —É —ç—Ç–æ–≥–æ –∏–≥—Ä–æ–∫–∞?')) {
        fetch(`/admin/remove_title/${playerId}`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'}
        }).then(() => location.reload());
    }
}

function editTitle(titleId) {
    alert('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∏—Ç—É–ª–∞ ID: ' + titleId + ' (—Ñ—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)');
}

function deleteTitle(titleId) {
    if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç–∏—Ç—É–ª? –û–Ω –±—É–¥–µ—Ç —É–±—Ä–∞–Ω —É –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤.')) {
        alert('–§—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
    }
}

function removeAllTitles() {
    if (confirm('–°–Ω—è—Ç—å –≤—Å–µ –∫–∞—Å—Ç–æ–º–Ω—ã–µ —Ç–∏—Ç—É–ª—ã —É –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤?')) {
        fetch('/admin/remove_all_titles', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'}
        }).then(() => location.reload());
    }
}

// Preview update
document.addEventListener('DOMContentLoaded', function() {
    const displayNameInput = document.querySelector('input[name="display_name"]');
    const colorInput = document.querySelector('input[name="color"]');
    const glowColorInput = document.querySelector('input[name="glow_color"]');
    const preview = document.getElementById('titlePreview');
    
    function updatePreview() {
        const displayName = displayNameInput.value || '–ü—Ä–∏–º–µ—Ä —Ç–∏—Ç—É–ª–∞';
        const color = colorInput.value;
        const glowColor = glowColorInput.value;
        
        preview.textContent = displayName;
        preview.style.background = `linear-gradient(45deg, ${color}, ${glowColor})`;
        preview.style.textShadow = `0 0 10px ${glowColor}`;
    }
    
    displayNameInput.addEventListener('input', updatePreview);
    colorInput.addEventListener('change', updatePreview);
    glowColorInput.addEventListener('change', updatePreview);
});
</script>
{% endblock %}
